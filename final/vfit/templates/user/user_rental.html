{% extends "base.html" %}
{% load humanize %}
{% block content %}
<div class="text-gray-100 font-poppins min-h-screen pt-20">
    <div class="flex">
        {% include 'user/menu.html' %}
        <div class="w-3/4 p-8 ml-6 mb-6 mr-8">
            <div class="flex justify-start mb-6 -mt-8 -mr-8 -ml-8">
                <div id="tab-all" onclick="filterStatus('all')" class="w-1/4 bg-yellow-500 text-black py-4 px-4 shadow-md text-xl text-center cursor-pointer">
                    ทั้งหมด
                </div>
                <div id="tab-reserved" onclick="filterStatus('reserved')" class="w-1/4 bg-black bg-opacity-50 py-4 px-4 shadow-md text-yellow-500 text-xl text-center cursor-pointer">
                    จองเช่า
                </div>
                <div id="tab-renting" onclick="filterStatus('renting')" class="w-1/4 bg-black bg-opacity-50 py-4 px-4 shadow-md text-yellow-500 text-xl text-center cursor-pointer">
                    กำลังเช่า
                </div>
                <div id="tab-overdue" onclick="filterStatus('overdue')" class="w-1/4 bg-black bg-opacity-50 py-4 px-4 shadow-md text-yellow-500 text-xl text-center cursor-pointer">
                    หมดเวลาเช่ายืม
                </div>
            </div>

            <div class="w-full h-full overflow-hidden">
                <div class="p-8 overflow-y-auto h-[calc(100%-2rem)]">
                    {% for rental in rental_history %}
                        <div class="bg-white text-black mb-8 border-b-2 p-4 rounded-lg">
                            <div class="flex border-b-2 justify-between items-center mb-4">
                                <p class="text-gray 
                                 ">รหัสอุปกรณ์: {{ rental.order_code }}</p>
                                {% if rental.status == 'renting' %}
                                    <p class="text-green-500">เวลาที่เหลือ: {{ rental.time_remaining }} วัน</p>
                                {% elif rental.status == 'overdue' %}
                                    <p class="text-red-500">เกินกำหนดเวลา: {{ rental.overdue_time }} วัน</p>
                                {% else %}
                                    <p class="text-gray-500">สถานะ: {{ rental.get_status_display }}</p>
                                {% endif %}
                            </div>
                            <div class="flex items-center">
                                <img src="{{ rental.product.image.url }}" alt="{{ rental.product.name }}" class="w-20 h-20 rounded mr-4">
                                <div class="flex-1">
                                    <h3 class="font-bold">{{ rental.product.name }}</h3>
                                    <p>วันที่รับ: {{ rental.get_date|date:"d/m/Y" }}</p>
                                    <p>วันที่ต้องคืน: {{ rental.return_date|date:"d/m/Y" }}</p>
                                    <p>จำนวน: x{{ rental.amount }}</p>
                                    <p class="text-gray-500">ประเภท: {{ rental.product.category }}</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-black">ค่าบริการ: {{ rental.total_price|intcomma }} บาท</p>
                                </div>
                            </div>
                        </div>
                    {% empty %}
                    <p class="text-center text-gray-500">ไม่มีประวัติการเช่า</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
        function filterStatus(status) {
        // ดึงทุกแท็บมาลบ active class
        document.querySelectorAll('[id^="tab-"]').forEach(tab => tab.classList.remove('bg-yellow-500', 'text-black'));
        document.querySelectorAll('[id^="tab-"]').forEach(tab => tab.classList.add('bg-black', 'bg-opacity-50', 'text-yellow-500'));

        // เพิ่ม active class ให้แท็บที่เลือก
        document.getElementById(`tab-${status}`).classList.remove('bg-black', 'bg-opacity-50', 'text-yellow-500');
        document.getElementById(`tab-${status}`).classList.add('bg-yellow-500', 'text-black');

        // ส่ง request เพื่อกรองข้อมูล
        fetch(`/rental-history/?status=${status}`)
            .then(response => response.text())
            .then(html => {
                document.querySelector('.p-8').innerHTML = html;
            });
    }
    // อัปเดตเวลาทุก 60 วินาที (ถ้าแสดงข้อมูลสด)
    setInterval(() => {
        location.reload();
    }, 60000);
</script>
{% endblock %}